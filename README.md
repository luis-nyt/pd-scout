# pd-scout

> **Pattern-driven codebase analysis for design system visibility**

pd-scout is an intelligent audit tool that helps design systems teams understand how their design system is being adopted across real-world codebases. Unlike traditional linters that follow fixed rules, pd-scout uses LLM-powered "agentic" exploration to understand context, recognize patterns, and provide nuanced recommendations.

**Built by:** NYT Design Systems team  
**Use case:** Auditing design system adoption, finding technical debt, identifying improvement opportunities

---

## Who Is This For?

**Primary users:**
- ðŸŽ¨ **Design system engineers** - Audit adoption across teams
- ðŸ”§ **Frontend leads** - Understand technical debt and inconsistencies
- ðŸ“Š **Product designers** - Track design system usage (via future web UI)

**When to use pd-scout:**
- You have a design system and want to know who's using it (and how)
- You're migrating to a new design system and need to inventory old patterns
- You want to find quick wins (code that almost matches your design system)
- You need to prioritize refactoring efforts based on impact

**When NOT to use pd-scout:**
- Real-time linting (use ESLint/Stylelint for that)
- Automated code fixes (pd-scout finds issues, you fix them)
- Small codebases (< 10 files - just review them manually)
- Projects without budget for OpenAI API costs ($1-10 per analysis)

---

## Quick Start

### Installation

**Note:** pd-scout is not published to npm yet. Build from source:

```bash
# 1. Install pnpm (if not already installed)
npm install -g pnpm

# 2. Navigate to pd-scout directory
cd /path/to/pd-scout

# 3. Install dependencies and build
pnpm install
pnpm build

# 4. Link globally (makes 'pd-scout' command available everywhere)
npm link

# 5. Verify it works
pd-scout --version

# 6. Set OpenAI API key
export OPENAI_API_KEY=sk-your-key-here

# 7. Initialize configuration in your project
cd /path/to/your/project
pd-scout init

# 8. Run analysis (dry run first to see cost)
pd-scout analyze --template typography-audit --dry-run

# 9. Run actual analysis
pd-scout analyze --template typography-audit

# 10. View results
cat output/*.json
```

**First time?** See [Getting Started Guide](docs/GETTING-STARTED.md) for detailed instructions.

## What Makes pd-scout Different?

Think of it like hiring a design systems expert to audit your codebase, instead of running a spell-checker.

### Traditional Linter (Fixed Rules)
```javascript
// Fixed rule: If fontSize !== token, flag it
if (file.includes("fontSize:") && !file.includes("tokens.")) {
  error("Use design tokens!");
}
```

**What it does:** Flags 100% of violations, no exceptions  
**Problem:** No context. Can't understand intent or patterns  
**Example:** Flags legacy code that's scheduled for deletion anyway

### pd-scout (Intelligent Analysis)
```
LLM explores â†’ Understands context â†’ Makes nuanced recommendations

Examples of nuance:
âœ“ "These 5 files are in a /legacy folder - lower priority"
âœ“ "This file has 30 instances - probably autogenerated, fix the generator"  
âœ“ "These use values that match your design system but aren't using tokens - quick wins"
âœ“ "This pattern appears in 20 files - suggest creating a reusable component"
```

**What it does:** Finds patterns, prioritizes by impact, understands codebase structure  
**Benefit:** Intelligent analysis that adapts to your codebase  
**Trade-off:** Costs money ($1-10 per analysis), takes longer (minutes not seconds)

### Comparison Table

| Feature | ESLint/Stylelint | pd-scout |
|---------|------------------|----------|
| **Speed** | Instant | 2-5 minutes |
| **Cost** | Free | $1-10 per run |
| **Context** | None | Full codebase understanding |
| **Customization** | Write JavaScript rules | Write YAML patterns |
| **Use case** | Real-time linting | Periodic audits |
| **Output** | List of errors | Prioritized opportunities with context |

**Use both:** ESLint for real-time linting, pd-scout for strategic audits.

## Core Concepts

### 1. Patterns (What to Look For)

Define what to search for in YAML - no code required:

```yaml
# patterns/typography.yaml
name: typography
filePatterns:
  - "**/*.tsx"
  - "**/*.css"

searchPatterns:
  typescript:
    - pattern: "fontSize:"
      description: "Inline font sizes"

categories:
  - id: not_using_design_system
    label: "âŒ Not Using Design System"
    priority: high
```

### 2. Templates (How to Analyze)

Define how the LLM should analyze:

```yaml
# templates/typography-audit.yaml
name: typography-audit
pattern: typography

systemPrompt: |
  You are a design systems expert.
  Find all typography usage and categorize by adoption level.
  
  Strategy:
  1. List files to understand structure
  2. Search for patterns
  3. Categorize each finding
  4. Prioritize by impact
```

### 3. Agentic Exploration

The LLM decides what to do based on what it learns:

```
Round 1: list_files("**/*.tsx") â†’ 200 files
Round 2: search_code("fontSize:") â†’ 47 matches
Round 3: read_files([sample files]) â†’ Understands patterns
Round 4: finish_analysis([categorized findings])
```

## Commands

### `analyze`

Run analysis on a codebase:

```bash
# Use a built-in template
pd-scout analyze --template typography-audit

# Analyze specific directory
pd-scout analyze -t typography-audit --repo ./src

# Customize budget
pd-scout analyze -t typography-audit --budget 50000

# Dry run (cost estimate)
pd-scout analyze -t typography-audit --dry-run
```

### `init`

Create a configuration file interactively:

```bash
pd-scout init
```

### `list`

Show available patterns and templates:

```bash
pd-scout list patterns
pd-scout list templates
```

### `validate`

Validate pattern or template files:

```bash
pd-scout validate patterns/my-pattern.yaml
pd-scout validate templates/my-template.yaml
```

## Configuration

Create `.pd-scout.yaml` in your project root:

```yaml
project:
  name: "my-app"
  designSystem: "MyDesignSystem"
  repo: "./src"

analysis:
  tokenBudget: 100000
  maxRounds: 10
  model: "gpt-4-turbo"

context:
  - url: "@https://github.com/my-org/design-system"
    type: "design-system"
```

## Built-in Patterns & Templates

### Patterns
- **typography**: Font usage across web and native
- **color**: Color values and theming

### Templates  
- **typography-audit**: Comprehensive typography analysis

## Creating Custom Patterns

1. Create a YAML file in `./patterns/`:

```yaml
# patterns/animation.yaml
name: animation
filePatterns:
  - "**/*.tsx"

searchPatterns:
  typescript:
    - pattern: "transition:"
      description: "CSS transitions"

categories:
  - id: not_using_motion_system
    label: "Not Using Motion System"
    priority: high
```

2. Use it:

```bash
pd-scout analyze --pattern animation
```

## Creating Custom Templates

1. Create a YAML file in `./templates/`:

```yaml
# templates/my-audit.yaml
name: my-audit
pattern: typography

systemPrompt: |
  Custom instructions for your team...

outputSchema:
  fields:
    - name: file
      type: string
      required: true
```

2. Use it:

```bash
pd-scout analyze --template my-audit
```

## Output Format

Results are saved as JSON:

```json
{
  "metadata": {
    "projectName": "my-app",
    "timestamp": "2024-11-08T...",
    "duration": 45000
  },
  "results": {
    "opportunities": [
      {
        "file": "Button.tsx",
        "lines": "23",
        "category": "not_using_design_system",
        "current": "fontSize: '16px'",
        "suggested": "fontSize: tokens.typography.body"
      }
    ],
    "patterns": [
      {
        "pattern": "Hardcoded fontSize",
        "occurrences": 47,
        "files": [...]
      }
    ],
    "summary": "Found 47 hardcoded font sizes..."
  },
  "usage": {
    "totalTokens": 52000,
    "estimatedCost": 1.50,
    "rounds": 5
  }
}
```

## Cost & Budget

**Token Budget = Money + Time**

| Budget | Use Case | Typical Cost |
|--------|----------|--------------|
| 25,000 | Quick scan | $0.50-$1.00 |
| 100,000 | Thorough audit | $2.00-$5.00 |
| 300,000 | Deep dive | $5.00-$15.00 |

Set `OPENAI_API_KEY` environment variable or provide in config.

## Caching

pd-scout caches:
- Cloned repositories (saves download time)
- Analysis results (optional)

Cache location: `./.pd-scout-cache/`

Clear cache:
```bash
rm -rf .pd-scout-cache
```

## Tips for Best Results

1. **Start narrow**: Analyze one feature at a time
2. **Use dry-run**: Check cost before running
3. **Leverage context**: Provide design system docs for better recommendations
4. **Iterate**: Adjust budget and templates based on results
5. **Review patterns**: LLM finds patterns you might not have thought to search for

## Troubleshooting

### Common Issues

**"command not found: pnpm"**
```bash
npm install -g pnpm
```

**"No configuration file found"**
```bash
pd-scout init
```

**"OpenAI API key not found"**
```bash
export OPENAI_API_KEY=sk-your-key-here
# Or add to .pd-scout.yaml or .env file
```

**"Build errors" or "Cannot find module"**
```bash
cd pd-scout
pnpm install
pnpm build
```

**High cost estimate**
```bash
# Reduce budget
pd-scout analyze --template typography-audit --budget 25000

# Narrow scope
pd-scout analyze -t typography-audit --repo ./src/components

# Use cheaper model
pd-scout analyze -t typography-audit --model gpt-3.5-turbo
```

**Analysis incomplete**
```bash
# Increase budget
pd-scout analyze -t typography-audit --budget 200000

# Or analyze smaller chunks
pd-scout analyze -t typography-audit --repo ./src/features/home
```

**For detailed troubleshooting**, see [Getting Started Guide](docs/GETTING-STARTED.md#troubleshooting-guide).

## Limitations & Known Issues

### Current Limitations

**Cost:** Each analysis costs $1-10 depending on codebase size and budget settings. Not suitable for continuous integration (yet).

**Speed:** Analysis takes 2-5 minutes. Not meant for real-time feedback.

**Non-deterministic:** LLM exploration may vary between runs. Same codebase might be analyzed slightly differently each time.

**Accuracy:** LLM can miss patterns or misinterpret code. Always review findings before acting.

**No auto-fix:** pd-scout finds issues, you fix them manually. Future versions may suggest codemods.

### Known Gaps

- **No test suite yet** - Help wanted! See [Contributing](#contributing)
- **CLI only** - Web dashboard planned for visual results browsing
- **OpenAI only** - Support for Claude, local models (Ollama) planned
- **Limited built-in patterns** - More patterns coming (color, spacing, accessibility)

### What pd-scout Is NOT

âŒ **Not a linter** - It doesn't enforce rules in real-time  
âŒ **Not a code formatter** - It doesn't format your code  
âŒ **Not free** - Requires OpenAI API budget  
âŒ **Not deterministic** - Results may vary slightly between runs  
âŒ **Not a CI tool** - Too slow and expensive for every commit (yet)

## Documentation

- **[Getting Started](docs/GETTING-STARTED.md)** - Complete setup and first analysis guide
- **[How It Works](docs/HOW-IT-WORKS.md)** - Plain-English explanation with analogies
- **[Architecture](docs/ARCHITECTURE.md)** - Technical deep dive for contributors

## Contributing

pd-scout is designed to be forked and customized for your team:

```bash
git clone https://github.com/nyt/pd-scout my-team-scout
cd my-team-scout

# Customize for your design system
vim .pd-scout.yaml
vim patterns/team-pattern.yaml

# Publish as team package
npm publish @my-team/scout
```

## License

MIT

## Credits

Built by NYT Design Systems team to help product teams build better, more consistent UIs.

---

**Questions?** See [docs/HOW-IT-WORKS.md](docs/HOW-IT-WORKS.md) for detailed explanations.

